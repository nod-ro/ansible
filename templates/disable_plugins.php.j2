<?php
// Replace these values with your actual database credentials
$dbHost = '{{db_host}}'; // Typically, something like 'your-db-server.mysql.database.azure.com'
$dbUsername = '{{db_user}}';
$dbPassword = '{{db_password}}';
$dbName = '{{db_name}}';

// Path to Azure's SSL certificate
$sslCA = '/tmp/mysql_certificate.pem'; // Update with the path to the SSL certificate file

$mysqli = mysqli_init();
if (!$mysqli) {
    die('mysqli_init failed');
}

// Setting SSL options for the connection
if (!mysqli_ssl_set($mysqli, NULL, NULL, $sslCA, NULL, NULL)) {
    die('Failed to set SSL parameters');
}

// Establishing a connection with SSL
if (!$mysqli->real_connect($dbHost, $dbUsername, $dbPassword, $dbName, 3306, NULL, MYSQLI_CLIENT_SSL)) {
    die('Connect Error (' . mysqli_connect_errno() . ') ' . mysqli_connect_error());
}

// The option you want to update and the new value
$optionName = 'active_plugins';

// Prepare SQL query to get the option value
$sql = "SELECT $optionName FROM wp_options WHERE option_name = '" . $mysqli->real_escape_string($optionName) . "' LIMIT 1";

$result = $mysqli->query($sql);

if ($result) {
    $row = $result->fetch_assoc();
    if ($row) {
        echo "Option Value: " . $row['option_value'];
    } else {
        echo "Option not found.";
    }
    $result->free();
} else {
    echo "Error retrieving option: " . $mysqli->error;
}


$newValue = $row['option_value'] . "xxxxxxxxx"; // Truncated for brevity

// Update option
$sql = "UPDATE wp_options SET option_value = '" . $mysqli->real_escape_string($newValue) . "' WHERE option_name = '" . $mysqli->real_escape_string($optionName) . "'";

if ($mysqli->query($sql) === TRUE) {
    echo "Option updated successfully";
} else {
    echo "Error updating option: " . $mysqli->error;
}

$mysqli->close();
?>

